
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间管理待办事项</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .task-item { transition: all 0.3s ease; }
        .task-item:hover { transform: translateY(-2px); }
        .completed { text-decoration: line-through; opacity: 0.7; }
        .urgent { border-left: 4px solid #ef4444; }
        .warning { border-left: 4px solid #f59e0b; }
        .normal { border-left: 4px solid #10b981; }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .alert { animation: pulse 1.5s infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <h1 class="text-3xl font-bold text-center text-indigo-700 mb-2">时间管理待办事项</h1>
        <p class="text-center text-gray-500 mb-8">为每个任务设置截止时间，智能提醒</p>
        
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex flex-col md:flex-row gap-2 mb-4">
                <input type="text" id="taskInput" placeholder="任务内容..." 
                    class="flex-grow px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <input type="datetime-local" id="taskTime" 
                    class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                <button id="addTaskBtn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition">
                    <i class="fas fa-plus mr-2"></i>添加任务
                </button>
            </div>
            
            <div class="flex justify-between items-center mb-4">
                <div class="flex space-x-4">
                    <span id="taskCount" class="text-gray-600">0 个任务</span>
                    <span id="urgentCount" class="text-red-500 hidden"><i class="fas fa-exclamation-circle mr-1"></i><span>0</span> 紧急</span>
                </div>
                <div class="flex space-x-2">
                    <button id="filterAll" class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm">全部</button>
                    <button id="filterActive" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">未完成</button>
                    <button id="filterCompleted" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">已完成</button>
                </div>
            </div>
            
            <ul id="taskList" class="space-y-2"></ul>
        </div>
        
        <div id="alertContainer" class="fixed bottom-4 right-4 space-y-2"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM元素
            const taskInput = document.getElementById('taskInput');
            const taskTime = document.getElementById('taskTime');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const taskList = document.getElementById('taskList');
            const taskCount = document.getElementById('taskCount');
            const urgentCount = document.getElementById('urgentCount');
            const alertContainer = document.getElementById('alertContainer');
            const filterAll = document.getElementById('filterAll');
            const filterActive = document.getElementById('filterActive');
            const filterCompleted = document.getElementById('filterCompleted');
            
            // 状态管理
            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            let currentFilter = 'all';
            let alertTimeout;
            let checkInterval;
            
            // 初始化
            function init() {
                renderTasks();
                setupDateTimeInput();
                startTaskChecker();
            }
            
            // 设置日期时间输入默认值
            function setupDateTimeInput() {
                const now = new Date();
                now.setMinutes(now.getMinutes() + 30);
                const datetime = now.toISOString().slice(0, 16);
                taskTime.value = datetime;
            }
            
            // 渲染任务列表
            function renderTasks() {
                taskList.innerHTML = '';
                
                const filteredTasks = tasks.filter(task => {
                    if (currentFilter === 'active') return !task.completed;
                    if (currentFilter === 'completed') return task.completed;
                    return true;
                });
                
                if (filteredTasks.length === 0) {
                    taskList.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-tasks text-4xl mb-2"></i>
                            <p>暂无任务</p>
                        </div>
                    `;
                    updateTaskCount();
                    return;
                }
                
                filteredTasks.forEach((task, index) => {
                    const li = document.createElement('li');
                    li.className = `task-item bg-white p-4 rounded-lg shadow-sm ${getPriorityClass(task)}`;
                    
                    const dueDate = new Date(task.dueTime);
                    const timeLeft = getTimeLeft(dueDate);
                    
                    li.innerHTML = `
                        <div class="flex items-start">
                            <input type="checkbox" ${task.completed ? 'checked' : ''} 
                                class="mt-1 mr-3 h-5 w-5 text-indigo-600 rounded focus:ring-indigo-500" 
                                data-index="${index}">
                            <div class="flex-grow">
                                <div class="flex justify-between items-start">
                                    <span class="${task.completed ? 'completed' : ''}">${task.text}</span>
                                    <span class="text-xs ${getTimeLeftClass(dueDate)} ml-2 whitespace-nowrap">
                                        ${formatTimeLeft(timeLeft)}
                                    </span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    <i class="far fa-clock mr-1"></i>截止: ${formatDateTime(dueDate)}
                                </div>
                            </div>
                            <button class="delete-btn text-gray-400 hover:text-red-500 ml-2" data-index="${index}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    taskList.appendChild(li);
                });
                
                updateTaskCount();
                updateUrgentCount();
            }
            
            // 更新任务计数
            function updateTaskCount() {
                const activeTasks = tasks.filter(task => !task.completed).length;
                taskCount.textContent = `${activeTasks} 个待办 / ${tasks.length} 个总数`;
            }
            
            // 更新紧急任务计数
            function updateUrgentCount() {
                const now = new Date();
                const urgentTasks = tasks.filter(task => {
                    if (task.completed) return false;
                    const dueDate = new Date(task.dueTime);
                    return dueDate - now < 24 * 60 * 60 * 1000; // 24小时内
                }).length;
                
                if (urgentTasks > 0) {
                    urgentCount.classList.remove('hidden');
                    urgentCount.querySelector('span').textContent = urgentTasks;
                } else {
                    urgentCount.classList.add('hidden');
                }
            }
            
            // 添加新任务
            function addTask() {
                const text = taskInput.value.trim();
                const dueTime = taskTime.value;
                
                if (!text) {
                    showAlert('请输入任务内容', 'error');
                    return;
                }
                
                if (!dueTime) {
                    showAlert('请设置截止时间', 'error');
                    return;
                }
                
                const now = new Date();
                const selectedTime = new Date(dueTime);
                
                if (selectedTime < now) {
                    showAlert('截止时间不能早于当前时间', 'error');
                    return;
                }
                
                tasks.push({
                    text,
                    dueTime,
                    completed: false,
                    createdAt: new Date().toISOString()
                });
                
                saveToLocalStorage();
                taskInput.value = '';
                setupDateTimeInput();
                renderTasks();
                showAlert('任务已添加', 'success');
            }
            
            // 删除任务
            function deleteTask(index) {
                tasks.splice(index, 1);
                saveToLocalStorage();
                renderTasks();
                showAlert('任务已删除', 'info');
            }
            
            // 切换任务完成状态
            function toggleTask(index) {
                tasks[index].completed = !tasks[index].completed;
                saveToLocalStorage();
                renderTasks();
                
                if (tasks[index].completed) {
                    showAlert('任务已完成', 'success');
                }
            }
            
            // 保存到本地存储
            function saveToLocalStorage() {
                localStorage.setItem('tasks', JSON.stringify(tasks));
            }
            
            // 显示提示信息
            function showAlert(message, type) {
                clearTimeout(alertTimeout);
                
                const alert = document.createElement('div');
                alert.className = `px-4 py-3 rounded-lg shadow-md flex items-center ${getAlertClass(type)}`;
                alert.innerHTML = `
                    <i class="${getAlertIcon(type)} mr-2"></i>
                    <span>${message}</span>
                `;
                
                alertContainer.appendChild(alert);
                
                alertTimeout = setTimeout(() => {
                    alert.remove();
                }, 3000);
            }
            
            // 获取提示样式
            function getAlertClass(type) {
                const classes = {
                    success: 'bg-green-100 text-green-700',
                    error: 'bg-red-100 text-red-700',
                    info: 'bg-blue-100 text-blue-700',
                    warning: 'bg-yellow-100 text-yellow-700'
                };
                return classes[type] || classes.info;
            }
            
            // 获取提示图标
            function getAlertIcon(type) {
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    info: 'fas fa-info-circle',
                    warning: 'fas fa-exclamation-triangle'
                };
                return icons[type] || icons.info;
            }
            
            // 格式化日期时间
            function formatDateTime(date) {
                return date.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
            
            // 获取剩余时间
            function getTimeLeft(dueDate) {
                const now = new Date();
                return dueDate - now;
            }
            
            // 格式化剩余时间
            function formatTimeLeft(timeLeft) {
                if (timeLeft <= 0) return '已过期';
                
                const seconds = Math.floor(timeLeft / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                const days = Math.floor(hours / 24);
                
                if (days > 0) return `${days}天后`;
                if (hours > 0) return `${hours}小时后`;
                if (minutes > 0) return `${minutes}分钟后`;
                return '即将到期';
            }
            
            // 获取优先级样式
            function getPriorityClass(task) {
                if (task.completed) return '';
                
                const dueDate = new Date(task.dueTime);
                const timeLeft = getTimeLeft(dueDate);
                
                if (timeLeft <= 0) return 'urgent alert';
                if (timeLeft < 60 * 60 * 1000) return 'urgent'; // 1小时内
                if (timeLeft < 24 * 60 * 60 * 1000) return 'warning'; // 24小时内
                return 'normal';
            }
            
            // 获取剩余时间样式
            function getTimeLeftClass(dueDate) {
                const timeLeft = getTimeLeft(dueDate);
                
                if (timeLeft <= 0) return 'text-red-500';
                if (timeLeft < 60 * 60 * 1000) return 'text-red-500'; // 1小时内
                if (timeLeft < 24 * 60 * 60 * 1000) return 'text-yellow-500'; // 24小时内
                return 'text-green-500';
            }
            
            // 开始任务检查器
            function startTaskChecker() {
                clearInterval(checkInterval);
                checkInterval = setInterval(() => {
                    checkDueTasks();
                    renderTasks();
                }, 60000); // 每分钟检查一次
                checkDueTasks(); // 立即检查一次
            }
            
            // 检查到期任务
            function checkDueTasks() {
                const now = new Date();
                const upcomingTasks = tasks.filter(task => {
                    if (task.completed) return false;
                    const dueDate = new Date(task.dueTime);
                    const timeLeft = dueDate - now;
                    return timeLeft > 0 && timeLeft < 15 * 60 * 1000; // 15分钟内到期
                });
                
                upcomingTasks.forEach(task => {
                    const dueDate = new Date(task.dueTime);
                    showAlert(`"${task.text}" 即将在${formatTimeLeft(dueDate - now)}到期`, 'warning');
                });
            }
            
            // 事件监听
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            taskList.addEventListener('click', (e) => {
                if (e.target.classList.contains('delete-btn') || e.target.closest('.delete-btn')) {
                    const index = e.target.closest('.delete-btn').getAttribute('data-index');
                    deleteTask(index);
                } else if (e.target.type === 'checkbox') {
                    const index = e.target.getAttribute('data-index');
                    toggleTask(index);
                }
            });
            
            filterAll.addEventListener('click', () => {
                currentFilter = 'all';
                renderTasks();
                updateFilterButtons();
            });
            
            filterActive.addEventListener('click', () => {
                currentFilter = 'active';
                renderTasks();
                updateFilterButtons();
            });
            
            filterCompleted.addEventListener('click', () => {
                currentFilter = 'completed';
                renderTasks();
                updateFilterButtons();
            });
            
            function updateFilterButtons() {
                const buttons = [filterAll, filterActive, filterCompleted];
                const filters = ['all', 'active', 'completed'];
                
                buttons.forEach((btn, index) => {
                    if (filters[index] === currentFilter) {
                        btn.classList.remove('bg-gray-100', 'text-gray-700');
                        btn.classList.add('bg-indigo-100', 'text-indigo-700');
                    } else {
                        btn.classList.remove('bg-indigo-100', 'text-indigo-700');
                        btn.classList.add('bg-gray-100', 'text-gray-700');
                    }
                });
            }
            
            // 初始化应用
            init();
        });
    </script>
</body>
</html>
